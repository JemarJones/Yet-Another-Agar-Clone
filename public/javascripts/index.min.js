/*This file mainly pertains to the front-end of the project: drawing the game
and ensuring the correct windows are being displayed.

In terms of modules, it includes the behaviour-hiding modules:
- Game input (grabs mouse co-ordinates)
- Game drawing (all the draw__() functions)
- Window drawing (displays and hides certain windows when appropriate)
- Window input (grabs textbox and button input)
The HTML and CSS files also relate to the Window modules, but the most important content is in this file.
*/
$(document).ready(function(){function e(){$("button").prop("disabled",!1),$("#startScreen").show(),$("#gameHelper").show(),$("#start").on("click",function(){var e={name:$("#pName").val()}
console.log(e.name),m.emit("playerReady",e),$("#startScreen").hide(),$("#start").prop("disabled",!0)}),$("#pName").keypress(function(e){13==e.which&&$("#start").trigger("click")})}function t(){P.strokeStyle="#d3d3d3",P.lineWidth=.5
for(var e=0;p>=e;e+=50)P.beginPath(),P.moveTo(0,e),P.lineTo(v,e),P.stroke(),P.closePath()
for(var t=0;v>=t;t+=50)P.beginPath(),P.moveTo(t,0),P.lineTo(t,p),P.stroke(),P.closePath()}function n(e,t,n,o,i){"smith"===o?(P.save(),P.beginPath(),P.arc(e,t,n,0,2*Math.PI),P.closePath(),P.clip(),P.drawImage(S,e-n,t-n,2*n,2*n),P.restore()):(P.fillStyle=o,P.beginPath(),P.arc(e,t,n,0,2*Math.PI),P.fill(),P.closePath()),i&&(P.lineWidth=3,P.strokeStyle="black",P.beginPath(),P.arc(e,t,n+5,0,2*Math.PI),P.closePath(),P.stroke())}function o(e,t,n){P.font="bold 30px Arial",P.fillStyle="white",P.textAlign="center",P.fillText(n,e,t+10),P.lineWidth=.5,P.strokeStyle="black",P.strokeText(n,e,t+10)}function r(e){for(i=0;i<e.length;i++)n(e[i].x,e[i].y,e[i].radius,e[i].color,e[i].powerup),o(e[i].x,e[i].y,e[i].name)}function a(e){for(i=0;i<e.length;i++)n(e[i].x,e[i].y,e[i].radius,e[i].color,e[i].powerup)}function c(e,n){if(k){var o=f(b)
P.setTransform(1,0,0,1,0,0),P.clearRect(0,0,T,I),W=-o.x+T/2,j=-o.y+I/2,P.translate(W,j),t(),a(w),r(e)}else P.setTransform(1,0,0,1,0,0),P.clearRect(0,0,T,I),P.translate(W,j),t(),a(w),r(e)}function l(){return document.hidden||document.msHidden||document.webkitHidden||document.mozHidden}function d(e){var t=y.getBoundingClientRect()
H.x=e.clientX-t.left,H.y=e.clientY-t.top}function s(e){if(!l()&&k){R.dx=H.x-T/2,R.dy=H.y-I/2
var t=f(b),n={id:t.id,x:t.x,y:t.y,mass:t.mass,radius:t.radius,color:t.color,dir:R}
m.emit("objUpdate",n)}}function h(){var e=f(b)
B=e.score,$("#score>span").text(B)}function f(e){for(var t=0;t<x.length;t++)if(x[t].id==e)return x[t]}function u(e,t,n){if(n)for(var o=e.length-1;o>=0;o--)for(var i=0;i<n.length;i++)e[o].id==n[i]&&e.splice(o,1)
for(var r=0;r<t.length;r++)e[e.length]=t[r]
return e}var m=io.connect("http://yaac-jkjones.rhcloud.com:8000"),g=!1,y=document.getElementById("agarCanvas")
y.width=window.innerWidth,y.height=window.innerHeight
var p,v,w,x,b,k,P=y.getContext("2d"),S=document.getElementById("smth"),T=y.width,I=y.height,H={x:0,y:0},R={dx:0,dy:0},W=0,j=0,B=0
e(),m.on("init",function(e){g=!0,w=e.foods,p=e.width,v=e.height,W=-e.x+T/2,j=-e.y+I/2}),m.on("ready",function(e){x=e.blobs,b=e.blobId,console.log(b),m.on("death"+b,function(){$("#score>span").text(""),$("#deathScreen").show(),$("#deathScore").text(B),console.log("Looks like we died.."),k=!1}),k=!0,c(x),window.addEventListener("mousemove",d)}),m.on("update",function(e){g&&(x=e.blobs,w=u(w,e.newFoods,e.eatenFoods),c(x,w),s(),k&&h())})})
